<div class="row text-center justify-between mx-auto">
    <div class="p-2 mb-2 bg-primary text-white float-end position-relative" style="z-index: 1;">
        <div *ngIf="authService.getRole() === 'ADMIN'">
            <span class="position-absolute top-0 start-0">
                <p-dropdown [options]="usersArray" [(ngModel)]="selectedUser" placeholder="Select a User"
                    optionLabel="name" inputId="float-label"
                    (ngModelChange)="onUserSelectionChange($event)"></p-dropdown>
            </span>
        </div>
        Calendar
        <button class="btn btn-link d-inline-block position-absolute top-0 end-0 ml-2" (click)="logout()">
            <img src="assets/logout.png" alt="logout" width="30" height="25">
        </button>
    </div>


    <div class="col-md-4">
        <div class="btn-group">
            <div class="btn btn-primary" mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate"
                (viewDateChange)="closeOpenMonthViewDay()">
                Previous
            </div>
            <div class="btn btn-outline-secondary change-on-hover" mwlCalendarToday [(viewDate)]="viewDate">
                Today
            </div>
            <div class="btn btn-primary" mwlCalendarNextView [view]="view" [(viewDate)]="viewDate"
                (viewDateChange)="closeOpenMonthViewDay()">
                Next
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <h3>{{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}</h3>
    </div>
    <div class="col-md-4 mb-2">
        <div class="btn-group">
            <div class="btn btn-primary" (click)="setView(CalendarView.Month)"
                [class.active]="view === CalendarView.Month">
                Month
            </div>
            <div class="btn btn-primary" (click)="setView(CalendarView.Week)"
                [class.active]="view === CalendarView.Week">
                Week
            </div>
            <div class="btn btn-primary" (click)="setView(CalendarView.Day)" [class.active]="view === CalendarView.Day">
                Day
            </div>
        </div>
    </div>
    <button class="btn btn-primary float-end" (click)="addEvent()">
        Add new
    </button>
</div>

<br />
<div [ngSwitch]="view" style="max-width: 95%; margin: 0 auto;">
    <mwl-calendar-month-view *ngSwitchCase="CalendarView.Month" [viewDate]="viewDate" [events]="(events | async) ?? []"
        [refresh]="refresh" [activeDayIsOpen]="activeDayIsOpen" (dayClicked)="dayClicked($event.day)"
        (eventClicked)="openModal($event.event)" (eventTimesChanged)="eventTimesChanged($event)">
    </mwl-calendar-month-view>
    <mwl-calendar-week-view *ngSwitchCase="CalendarView.Week" [viewDate]="viewDate" [events]="(events | async) ?? []"
        [refresh]="refresh" (eventClicked)="openModal($event.event)" [dayStartHour]="7" [dayEndHour]="24"
        (eventTimesChanged)="eventTimesChanged($event)">
    </mwl-calendar-week-view>
    <mwl-calendar-day-view *ngSwitchCase="CalendarView.Day" [viewDate]="viewDate" [events]="(events | async) ?? []"
        [refresh]="refresh" (eventClicked)="openModal($event.event)" [dayStartHour]="7" [dayEndHour]="24"
        (eventTimesChanged)="eventTimesChanged($event)">
    </mwl-calendar-day-view>
</div>

<ng-template #modalContent let-close="close">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">{{action}} Event</h5>
            <button type="button" class="btn-close" aria-label="Close"
                (click)="modalService.dismiss('cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="title" class="form-label">Title:</label>
                <input type="text" id="title" class="form-control" [(ngModel)]="modalData.event.title"
                    (keyup)="refresh.next()" />
            </div>
            <div class="mb-3">
                <label for="primaryColor" class="form-label">Primary:</label>
                <input type="color" id="primaryColor" class="form-control form-control-color"
                    [(ngModel)]="modalData.event.color!.primary" (change)="refresh.next()" />
            </div>
            <div class="mb-3">
                <label for="secondaryColor" class="form-label">Secondary:</label>
                <input type="color" id="secondaryColor" class="form-control form-control-color"
                    [(ngModel)]="modalData.event.color!.secondary" (change)="refresh.next()" />
            </div>
            <div class="mb-3">
                <label for="textColor" class="form-label">Text Color:</label>
                <input type="color" id="textColor" class="form-control form-control-color"
                    [ngModel]="modalData.event.color!.secondaryText ?? '#1e90ff'"
                    (ngModelChange)="modalData.event.color!.secondaryText = $event" (change)="refresh.next()" />
            </div>
            <div *ngIf="authService.getRole() === 'ADMIN'">
                <label for="start" class="form-label">Add collaborateur:</label> <br>
                <ng-multiselect-dropdown [placeholder]="'Add collaborateur...'" [settings]="dropdownSettings"
                    [data]="dropdownList" [(ngModel)]="selectedItems" (onSelect)="onItemSelect($event)"
                    (onSelectAll)="onSelectAll($event)">
                </ng-multiselect-dropdown>
            </div>
            <div class="mb-3">
                <label for="start" class="form-label">Start:</label> <br>
                <p-calendar inputId="start" [(ngModel)]="modalData.event.start" [showTime]="true" hourFormat="24">
                </p-calendar>
            </div>
            <div class="mb-1">
                <label for="end" class="form-label">End:</label><br>
                <p-calendar inputId="end" [(ngModel)]="modalData.event.end" [showTime]="true" hourFormat="24"
                    appDateRangeValidator [startDate]="modalData.event.start"></p-calendar>
            </div>
            <div *ngIf="endDateInvalid()" class="text-center" style="background-color: #eb6969; color: white; padding: 10px;border-radius: 5px;">end date must be after start date.</div>
        </div>
        <button type="button" class="btn btn-outline-secondary" style="margin-bottom: 2px;"
            (click)="close(modalData.event)">{{action}}</button>
        <button *ngIf="action === 'Update'" type="button" class="btn btn-danger" style="margin-bottom: 2px;"
            (click)="close(modalData.event.id)">
            Delete
        </button>
    </div>
</ng-template>